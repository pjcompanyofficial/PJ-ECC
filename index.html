<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PJ-ECC | Secure Portal Ultimate v8.0</title>
    
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --pj-orange: #ff6a00;
            --pj-red: #ff3131;
            --pj-green: #00ff88;
            --bg-dark: #050505;
            --card-bg: rgba(10, 10, 10, 0.98);
            --border-color: rgba(255, 106, 0, 0.4);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Roboto', sans-serif; background: var(--bg-dark); color: #fff; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        header { padding: 15px; text-align: center; background: #000; border-bottom: 1px solid var(--border-color); font-family: 'Orbitron'; color: var(--pj-orange); letter-spacing: 2px; font-weight: 900; }

        .container { flex: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; position: relative; }
        
        .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 35px; padding: 25px; width: 100%; max-width: 420px; box-shadow: 0 0 30px rgba(255,106,0,0.1); margin-top: 10px; z-index: 5; transition: all 0.3s ease; }

        .btn { width: 100%; padding: 16px; border: none; border-radius: 15px; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; margin-top: 15px; background: linear-gradient(90deg, #ff4e00, #ec1c24); color: #fff; font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; transition: all 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #222; color: #444; cursor: not-allowed; opacity: 0.5; }
        
        .btn.sec { background: transparent; border: 1px solid #333; }

        /* Admin Trigger Button */
        .admin-btn {
            margin-top: 40px;
            background: rgba(255, 106, 0, 0.05);
            border: 1px solid rgba(255, 106, 0, 0.3);
            color: var(--pj-orange);
            font-size: 11px;
            letter-spacing: 2px;
            padding: 15px;
        }

        /* Password Modal Styling */
        .login-box { text-align: center; }
        .pass-input {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 10px;
            color: #fff;
            font-family: 'Orbitron';
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            transition: border-color 0.3s;
        }
        .pass-input:focus { border-color: var(--pj-orange); }
        .pass-input.valid { border-color: var(--pj-green); box-shadow: 0 0 10px var(--pj-green); }

        .back-link { margin-top: 20px; display: block; color: #666; font-size: 12px; cursor: pointer; text-decoration: underline; font-family: 'Orbitron'; }
        .back-link:hover { color: var(--pj-red); }

        /* Scanner Elements */
        .scanner-container {
            position: relative; width: 100%; aspect-ratio: 1/1; margin: 0 auto;
            border-radius: 25px; overflow: hidden; border: 4px solid var(--pj-orange); background: #000;
        }
        .scanner-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; z-index: 10; }
        .pulse-ring { position: absolute; width: 10px; height: 10px; border: 2px solid var(--pj-orange); border-radius: 50%; opacity: 0; animation: ringPulse 2.5s infinite; }
        @keyframes ringPulse { 0% { width: 10px; height: 10px; opacity: 1; } 100% { width: 350px; height: 350px; opacity: 0; } }

        /* Result View */
        .id-card { 
            width: 320px; background: #000; border: 1px solid var(--pj-orange); 
            border-radius: 25px; overflow: hidden; box-shadow: 0 20px 50px #000;
        }
        .card-top { height: 60px; background: var(--pj-orange); display: flex; align-items: center; justify-content: center; font-family: 'Orbitron'; font-weight: 900; color: #000; }
        .card-body { padding: 20px; }
        .info-value { font-size: 16px; font-weight: bold; font-family: 'Orbitron'; margin-bottom: 15px; color: #fff; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>PJ-ECC v8.0</header>

    <div class="container">
        <!-- Home Page -->
        <div id="viewHome" class="card">
            <h2 style="font-family:Orbitron; color:var(--pj-orange); text-align:center; margin-bottom:30px;">SECURITY ACCESS</h2>
            <button class="btn" onclick="startScanner()">LIVE SCANNER</button>
            <button class="btn sec" onclick="document.getElementById('galleryInput').click()">GALLERY SCAN</button>
            <input type="file" id="galleryInput" accept="image/*" class="hidden" onchange="scanImage(this)">
            
            <button class="btn admin-btn" onclick="showLogin()">SYSTEM ADMINISTRATION</button>
        </div>

        <!-- Admin Login Screen -->
        <div id="viewLogin" class="card hidden">
            <div class="login-box">
                <h3 style="font-family:Orbitron; color:var(--pj-orange);">ADMIN LOGIN</h3>
                <p style="font-size:10px; opacity:0.6;">ENTER ACCESS KEY TO CONTINUE</p>
                
                <input type="password" id="adminPass" class="pass-input" placeholder="••••••••" oninput="checkPass()">
                
                <button id="loginBtn" class="btn" onclick="accessAdmin()" disabled>CONTINUE TO PANEL</button>
                <span class="back-link" onclick="showHome()">← BACK TO HOME</span>
            </div>
        </div>

        <!-- Admin Panel (Employee Details Page) -->
        <div id="viewSetup" class="card hidden">
            <h3 style="font-family:Orbitron; color:var(--pj-orange); text-align:center;">ADMIN PANEL</h3>
            <p style="font-size:10px; color:var(--pj-green); text-align:center; margin-bottom:20px;">✓ AUTHENTICATED ACCESS</p>
            
            <input type="text" id="setupName" placeholder="Employee Name" class="btn sec" style="text-align:left;" oninput="validateSetup()">
            <input type="text" id="setupRef" placeholder="Ref ID (e.g. PJ-101)" class="btn sec" style="text-align:left;" oninput="validateSetup()">
            <input type="text" id="setupExp" value="17 FEB 2027" class="btn sec" style="text-align:left;">
            
            <button class="btn" id="genBtn" onclick="generateSecureQR()" disabled>GENERATE ACCESS QR</button>
            
            <div id="qrPreviewArea" class="hidden" style="margin-top:20px; text-align:center;">
                <div id="qrcode" style="background:#fff; padding:10px; display:inline-block; border-radius:10px;"></div>
                <p style="font-size:10px; margin-top:5px; opacity:0.6;">SAVE THIS FOR EMPLOYEE</p>
            </div>

            <button class="btn sec" onclick="showHome()" style="margin-top:20px; border-color:var(--pj-red); color:var(--pj-red);">LOGOUT</button>
        </div>

        <!-- Scanner View -->
        <div id="viewScanner" class="card hidden">
            <div class="scanner-container" id="scannerBorder">
                <div id="reader"></div>
                <div class="scanner-overlay" id="ringOverlay">
                    <div class="pulse-ring"></div>
                </div>
            </div>
            <button class="btn sec" onclick="stopScanner()">CANCEL</button>
        </div>

        <!-- Result View -->
        <div id="viewResult" class="hidden">
            <div class="id-card">
                <div class="card-top">GRANTED</div>
                <div class="card-body">
                    <div class="info-value" id="resName" style="color:var(--pj-orange);">---</div>
                    <div class="info-value" id="resID" style="font-size:12px; opacity:0.7;">---</div>
                    <div class="info-value" id="resExp" style="font-size:10px; color:var(--pj-green);">---</div>
                </div>
            </div>
            <button class="btn" onclick="showHome()">BACK</button>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        let html5QrCode = null;

        function showHome() { 
            hideAll(); 
            $('viewHome').classList.remove('hidden'); 
            $('adminPass').value = "";
            checkPass();
        }

        function showLogin() {
            hideAll();
            $('viewLogin').classList.remove('hidden');
            $('adminPass').focus();
        }

        function hideAll() { 
            document.querySelectorAll('.card, #viewResult').forEach(v => v.classList.add('hidden')); 
        }

        // Admin Logic
        function checkPass() {
            const pass = $('adminPass').value;
            const btn = $('loginBtn');
            const input = $('adminPass');
            
            if (pass === "sonu@jeet") {
                btn.disabled = false;
                input.classList.add('valid');
            } else {
                btn.disabled = true;
                input.classList.remove('valid');
            }
        }

        function accessAdmin() {
            hideAll();
            $('viewSetup').classList.remove('hidden');
        }

        function validateSetup() {
            $('genBtn').disabled = !($('setupName').value && $('setupRef').value);
        }

        function generateSecureQR() {
            const data = { n: $('setupName').value, r: $('setupRef').value, e: $('setupExp').value, s: "SECURE_PJ_V3" };
            $('qrcode').innerHTML = "";
            new QRCode($('qrcode'), { text: btoa(JSON.stringify(data)), width: 150, height: 150 });
            $('qrPreviewArea').classList.remove('hidden');
        }

        // Scanner Logic
        async function startScanner() {
            hideAll();
            $('viewScanner').classList.remove('hidden');
            html5QrCode = new Html5Qrcode("reader");
            await html5QrCode.start({ facingMode: "environment" }, { fps: 20, qrbox: 200 }, onScanSuccess);
        }

        async function stopScanner() {
            if (html5QrCode) await html5QrCode.stop();
            showHome();
        }

        function onScanSuccess(decodedText) {
            try {
                const data = JSON.parse(atob(decodedText));
                if (data.s === "SECURE_PJ_V3") {
                    if (html5QrCode) html5QrCode.stop();
                    hideAll();
                    $('resName').innerText = data.n;
                    $('resID').innerText = data.r;
                    $('resExp').innerText = data.e;
                    $('viewResult').classList.remove('hidden');
                }
            } catch(e) {}
        }

        function scanImage(input) {
            if (!input.files[0]) return;
            const tempReader = new Html5Qrcode("reader");
            tempReader.scanFile(input.files[0], true).then(onScanSuccess).catch(() => alert("Invalid Code"));
        }
    </script>
</body>
</html>


